#
# Read JSON file generated by the "compliance checks" Ansible
# playbook and generate a summary report
#
# Inputs (specified as extra-vars)
#
# - input: file name
# - format: Jinja2 template name (in templates directory)
# - output: Output file name
#
# Defaults:
# - format = json-simple.j2
# - output = errors-txt.j2
#
---
- hosts: all
  tasks:
  - assert:
      that: input is defined
      msg:  Have to specify INPUT extra variable
  - set_fact:
      json_data: "{{ lookup('file',input)|from_json }}"
  - set_fact:
      results: "{{ json_data|json_query('plays[].tasks[]') }}"
  - template:
      src:  "templates/{{format|default('json-simple')}}.j2"
      dest: "results/{{output|default('errors.txt')}}"
